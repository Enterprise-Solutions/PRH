<?php echo $this->doctype(); ?>

<html lang="es">
    <head>
        <meta charset="utf-8">
        <title>Sistema de Gestion</title>
        <link rel="stylesheet" href="<?=$this->basePath();?>/extjs/resources/css/ext-all.css"/>
        <link rel="stylesheet" href="<?=$this->basePath();?>/css/layout/style.css"/>
        <link rel="stylesheet" href="<?=$this->basePath();?>/css/layout/menu.css"/>
		<script type="text/javascript" src="<?php echo $this->basePath(); ?>/extjs/adapter/ext/ext-base.js"></script>
		<script type="text/javascript" src="<?php echo $this->basePath(); ?>/extjs/ext-all.js"></script>
		<script type="text/javascript" src="<?=$this->basePath()?>/extjs/src/locale/ext-lang-es.js">  </script> 
		<script type="text/javascript">

		var baseURL = '<?=$this->basePath()?>';
		
		var menuPrincipal = [
		                     {
			                     modulo: 'org',
			                     texto: 'Organizacion',
			                     operaciones: [
			                                   {
				                                   nombre: 'Mantener Sede',
				                                   url: 'sede'
			                                   },
			                                   {
				                                   nombre: 'Mantener Tipo Sede',
				                                   url: 'tipo-sede'
			                                   }
			  			  		 ]
		                     },
		                     {
			                     modulo: 'stock',
			                     texto: 'Stock',
			                     operaciones:[
												{
												    nombre: 'Stock 1',
												    url: 'stock1'
												}
 			                     ]
		                     },
		                     {
			                     modulo: 'adm',
			                     texto: 'Administracion',
			                     operaciones:[
												{
												    nombre: 'Adm1',
												    url: 'adm1'
												}
			                     ]
		                     },
		                     {
			                     modulo: 'cont',
			                     texto: 'Contabilidad',
			                     operaciones:[
												{
												    nombre: 'Cont 1',
												    url: 'cont1'
												}
			                     ]
		                     },
		                     {
			                     modulo: 'rep',
			                     texto: 'Reportes',
			                     operaciones:[
												{
												    nombre: 'Rep1',
												    url: 'rep1'
												}
			                     ]
		                     }
		];
		
			Ext.onReady(function(){

				
	
				//creamos un contenedor para todo el contenido general centrado
				var mainContainer = new Ext.Container({
					layout: 'column',
					width: 1024,
					height: 484,
					autoScroll:true,
					cls: 'mainContainer',
					renderTo: 'containerDiv',
					items:[
					       {
						       xtype:'container',
						       height: 50,
						       layout: 'column',
						       itemId: 'frameSuperiorArriba',
						       columnWidth: 1,
						       items:[
										{
											xtype:'container',
										    width: 200,
										    height: 50,
										    cls: 'logoEmpresa'
										},
										{
											xtype:'container',
										    columnWidth: 1,
										    layout: 'anchor',
										    height: 50,
										    items:[
										           {
											           xtype:'container',
											           width: 100,
													   style:{float:'right', paddingTop: '10px'},
													   items:[
																{
																    xtype: 'box',
																    cls: 'listaHorizontal',
																    height: 50,
																    html: '<ul><li><a href="#">Salir</a></li><li><a href="#">Ayuda</a></li></ul>'
																}
													   ]
										           }
										           
										 	]
										}
							   ]
					       },
					       {
					    	   xtype:'container',
					    	   height: 50,
					    	   id: 'frameSuperiorAbajo',
						       columnWidth: 1,
							   cls: 'menuContainer',
						       items:[
										{
											xtype:'container',
											height: 25,
									        style:{margin: '0 30px 0 0'},
										 	columnWidth: 1,
										 	data: menuPrincipal,
										 	tpl: new Ext.XTemplate(
										 		'<ul class="menuPrimerNivel">',
												'<tpl for=".">',
														'<li id="{[this.getLinkId()]}" class="liPrimerNivel" codigo="{modulo}">{texto}',
														'</li>',
												'</tpl>',
												'</ul>',
												{
													getLinkId: function(values)
													{
														var result = Ext.id();
												        this.addListener.defer(1, this, [result]);
												        return result;
													},
													addListener: function(id)
													{

														Ext.get(id).on('mouseover', function(e)
																{
																	
																	e.stopEvent();
																	
																	//el codigo donde se hizo click
																	var codigoClick = this.dom.attributes.codigo.value;
																	var valor = null;
																	
																	//tenemos que encontrar el codogp
																	for(var x=0; x<menuPrincipal.length; x++)
																	{
																		if(menuPrincipal[x].modulo == codigoClick)
																		{
																			valor = menuPrincipal[x];
																			break;
																		}
																	}
																	
																	if(valor)
																	{
																		
																		//guardamos los datos
																		var listaHija = valor;
																		listaHija.modulo = valor.modulo;
																		//encontramos destino y agregamos los datos
																		var abuelo = Ext.getCmp('frameSuperiorAbajo');
																		var buscado = abuelo.find('itemId','listaNivelDos');
																		if(buscado.length>0)
																		{
																			buscado = buscado[0];
																			buscado.tpl.overwrite(buscado.el, listaHija);
																		}
																	}
																	
																	
																}
															);
														/*
														Ext.get(id).on('mouseover', function(e)
															{
																console.log(id, this);
																e.stopEvent();
																var listaHija = this.dom.children[0];
																if(listaHija){
																	listaHija.style.display = 'block';
																}
															}
														);

														Ext.get(id).on('mouseout', function(e)
																{
																	e.stopEvent();
																	var listaHija = this.dom.children[0];
																	if(listaHija){
																		listaHija.style.display = 'none';
																	}
																}
															);
														*/
													}
												}
											)
										},
										{
											xtype:'container',
											height: 25,
										 	columnWidth: 1,
										 	cls: 'menuSegundoNivelContenedor',
										 	itemId: 'listaNivelDos',
										 	style:{backgroundColor:'darkblue',  margin: '0 10px', borderTop: '1px solid black'},
										 	tpl: new Ext.XTemplate(
										 		'<ul class="menuSegundoNivel">',
													'<tpl for="operaciones">',
														'<li class="liSegundoNivel">',
															'<a href="{[this.getHref(parent,values)]}">{nombre}</a>',
														'</li>',
													'</tpl>',
												'</ul>',
												{
													getHref: function(parent,values)
													{
														return baseURL + '/' + parent.modulo + '/' + values.url;
													}
												}
											)
										}
							   ]
					       }
					]
				});
				
			});//onready
		
		</script>
    </head>
    <body id='bodyHTML'>
       <div id='frameDiv' class='frameDiv'>
       	<div id='containerDiv'>
       	</div>
       </div>
    </body>
</html>
